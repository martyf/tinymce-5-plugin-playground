!function () {
    "use strict";
    tinymce.PluginManager.add("flags", function (t, e) {
        return t.ui.registry.addAutocompleter("autocompleter-flags", {
            ch: "#",
            minChars: 2,
            columns: 1,
            fetch: function (t) {
                return new tinymce.util.Promise(function (e) {
                    fetch("https://restcountries.eu/rest/v2/name/" + t + "?fields=name;flag").then(t => t.json()).then(function (t) {
                        let n = [];
                        for (let e = 0; e < t.length; e++)
                        {
                            let i = t[e];
                            n.push({
                                value: i.name + "|" + i.flag,
                                text: i.name,
                                icon: '<img src="' + i.flag + '" width="28" height="14" style="width:28px; height:14px;">'
                            })
                        }
                        n.sort(function (t, e) {
                            let n = t.text.toLowerCase(), i = e.text.toLowerCase();
                            return n < i ? -1 : n > i ? 1 : 0
                        }), e(n)
                    })
                })
            },
            onAction: function (e, n, i) {
                let o = i.split("|"), r = o[0], l = '<img src="' + o[1] + '" alt="' + r + '" width="48" height="24">';
                t.selection.setRng(n), t.insertContent(l), e.hide()
            }
        }), {
            getMetadata: function () {
                return {
                    name: "Flags Autocompleter example",
                    url: "https://www.martyfriedel.com/blog/tinymce-5-creating-an-autocomplete-plugin"
                }
            }
        }
    })
}();